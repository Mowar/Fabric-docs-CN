# Introduction - 引言

一般而言，区块链是在 _节点_ 的分布式网络中被维护的，不可变更的交易账本。这些节点通过应用已经由 _共识协议_ 验证的交易，来分别维护账本的副本，该交易被分组为包括将每个区块绑定到前一个区块的散列的区块。

区块链的第一个、也是最广为人知的应用是[比特币](https://en.wikipedia.org/wiki/Bitcoin)加密货币，其他应用都跟随它的脚步产生。以太币是另一种加密货币，采用了不同的方法，集成了许多与比特币相同的特性，但增加了 _智能合约_ ，从而为分布式应用创建了一个平台。比特币和以太坊属于一类区块链，我们将其归类为 _公共非许可_ 区块链技术。基本上，这些是公共网络，对任何人开放，参与者匿名互动。

随着比特币，以太坊和其他一些衍生技术的普及，更具创新性地将区块链基础技术、分布式账本和分布式应用平台应用于 _企业_ 用例的兴趣也在增长。但是，许多企业用例要求无授权区块链技术不可（目前）交付的性能特征。此外，在许多用例中，参与者的身份是一项硬性要求，如在金融交易情况下，必须遵循“了解客户”和“反洗钱”的法规。

对于企业用途，我们需要考虑以下要求：
-	必须识别/可识别参与者
-	网络需要获得许可
-	高交易吞吐量性能
-	交易确认的低延迟
-	与商业交易有关的交易和数据的隐私和机密性

虽然许多早期的区块链平台目前适合企业使用，但Hyperledger Fabric 从一开始就被 _设计_ 于企业用途。以下部分描述了Hyperledger Fabric（Fabric）如何将自己与其他区块链平台区分开来，并描述了其架构决策的一些动机。

## Hyperledger Fabric

Hyperledger Fabric是一种开源的企业级许可分布式账本技术平台，专为在企业环境中使用而设计，与其他流行的分布式账本或区块链平台相比，它有一些关键的差异化功能。

一个关键差异点是Hyperledger是在Linux基金会下建立的，该基金会本身在**开放式治理**下培育开源项目的历史悠久且非常成功，这些项目可以发展强大的持续社区和蓬勃发展的生态系统。Hyperledger由多元化技术指导委员会和Hyperledger Fabric项目管理，该项目由来自多个组织的各种维护人员组成。它拥有一个开发社区，自最早提交以来已经发展到超过35个组织和近200个开发人员。

Fabric具有高度**模块化**和**可配置**的架构，可为各种行业用例提供创新，多功能性和优化，包括银行，金融，保险，医疗保健，人力资源，供应链甚至数字音乐传递。

Fabric是第一个支持**用通用编程语言编写智能合约**（如Java，Go和Node.js）的分布式账本平台，而不是受限制的领域特定语言（DSL）。这意味着大多数企业已经拥有开发智能合约所需的技能，并且不需要额外的培训来学习新的语言或领域特定语言。

Fabric平台也获得了**许可**，这意味着，与公共非许可网络不同，参与者彼此了解，而不是匿名，因此完全不受信任。这意味着，尽管参与者可能不会 _完全_ 信任彼此（例如，在同行业竞争对手），网络可以在建立在参与者之间 _确实_ 存在的信任之上的治理模式下运行，如处理有争议的法律协议或框架。

该平台最重要的区别之一是它支持**可插拔的共识协议**，使平台能够更有效地进行定制以适应特定的用例和信任模型。例如，当部署在单个企业内或由可信任的权威机构运营时，完全拜占庭容错的共识可能被认为是不必要的，并且对性能和吞吐量造成过度拖累。在诸如此类的情况下，[崩溃容错](https://en.wikipedia.org/wiki/Fault_tolerance)共识协议可能绰绰有余，而在去中心化用例中，可能需要更传统的[拜占庭容错](https://en.wikipedia.org/wiki/Byzantine_fault_tolerance)共识协议。

Fabric可以利用**不需要本机加密货币**的共识协议来激活昂贵的采矿或推动智能合约执行。避免加密货币会减少一些重要的风险/攻击向量，并且缺少加密挖掘操作意味着可以使用与任何其他分布式系统大致相同的运营成本来部署平台。

这些差异化设计特性的结合使Fabric成为当今业务处理和事务确认延迟方面**性能更好的平台**之一，它实现了交易的**隐私和保密**以及它们的智能合约（Fabric称之为“链码”）。

让我们更详细地探索这些差异化的功能。

## Modularity - 模块化

Hyperledger Fabric被专门设计为具有模块化架构。无论是可插拔的共识、可插拔的身份管理协议（如LDAP或OpenID Connect）、密钥管理协议，还是加密库，该平台的核心设计旨在满足企业用例需求的多样性。

在高层次水平下，Fabric由以下模块化组件组成：
-	可插拔 _排序服务_ 就交易顺序建立共识，然后向所有节点广播各区块。
- 可插入的 _成员服务提供者_ 负责将网络中的实体与加密身份相关联。
- 可选的 _P2P gossip服务_ 通过与其他节点的交易服务来传播区块输出。
- 智能合约（“链码”）在容器环境（例如Docker）内运行以隔离。它们可以用标准编程语言编写，但不能直接访问账本状态。
- 账本可以配置成支持各种DBMS。
- 可插拔的认可和验证政策实施，可根据应用程序独立配置。

业界一致公认，不存在“一个区块链统治所有人”的情况。Hyperledger Fabric可以通过多种方式进行配置，以满足多个行业用例的各种解决方案要求。

## Permissioned vs Permissionless Blockchains - 许可区块链与非许可区块链

在一个非许可区块链中，几乎任何人都可以参与，每个参与者都是匿名的。在这样的情况下，除了在某个深度之前区块链的状态是不可变的之外，不存在任何信任。为了减轻这种信任的缺失，非许可区块链通常采用“挖掘”的本地加密货币或交易费用来提供经济激励，以抵消参与基于“工作量证明”(PoW)的拜占庭容错共识形式的特殊成本。

另一方面，**许可**区块链在一组已知的、已识别的且经常经过审查的参与者中操作区块链，这些参与者在产生一定程度信任的治理模型下运作。许可的区块链提供了一种方法来保护具有共同目标，但可能彼此不完全信任的一组实体之间的交互。通过依赖参与者的身份，许可的区块链可以使用更传统的崩溃容错（CFT）或拜占庭容错（BFT）共识协议，而不需要昂贵的挖掘。

另外，在这种许可情况下，参与者故意通过智能合约引入恶意代码的风险降低。首先，参与者彼此了解，且无论是提交应用程序交易、修改网络配置还是部署智能合约的所有行为，都被记录在区块链上，该区块链遵从为网络和相关交易类型建立的认可政策。这样不是完全匿名，因而可以很容易地识别有罪方，并根据治理模式的条款处理事件。

## Smart Contracts - 智能合约

作为受信任的分布式应用程序，智能合约，即Fabric中的“链码”从区块链获得其安全性/信任以及同行之间的基本共识。它是区块链应用的业务逻辑。

应用智能合约有三个关键点，尤其是应用于某个平台时：
- 许多智能合约在网络中同时运行，
- 它们可以动态部署（在很多情况下、由任何人），
- 应用代码应视为不受信任的，甚至可能是恶意的。

大多数现有的具有智能合约能力的区块链平台遵循**排序执行**架构，其中共识协议：
- 验证并将交易排序，然后将它们传播到所有节点，
- 每个节点按顺序执行交易。

几乎所有现有的区块链系统都可以找到排序执行架构，范围从公共/非许可平台，如[以太坊](https://ethereum.org/) （基于PoW的共识）到许可平台，如[Tendermint](http://tendermint.com/)，[Chain](http://chain.com/)和[Quorum](http://www.jpmorgan.com/global/Quorum)。

在区块链中执行的与排序执行架构一起运行的智能合约必须是确定性的；否则，可能永远不会达成共识。为了解决不确定性问题，许多平台要求智能合约以非标准或特定于域的语言（例如[Solidity](https://solidity.readthedocs.io/en/v0.4.23/)）编写，以便可以消除不确定性操作。这阻碍了智能合约的广泛应用，因为它要求开发人员编写智能合同以学习新语言，且可能导致编程错误。

此外，由于所有节点都按顺序执行所有交易，性能和规模是有限的。智能合约代码在系统中的每个节点上执行，这要求采取复杂措施来保护整个系统免受潜在恶意合同的影响，以确保整个系统的弹性。

## A New Approach - 一种新方法

Fabric为我们称为**排序执行验证**的交易引入了一种新的体系结构 。为了解决排序执行模型面临的弹性、灵活性、可伸缩性、性能和机密性问题，它将交易流分为三个步骤：
- _执行_ 一个交易并检查其正确性，从而给它背书，
- 通过（可插入的）共识协议将交易 _排序_ ，以及
- 根据特定应用程序的认可政策 _验证_ 交易，再将其提交到帐本

这种设计与排序执行范例完全不同，因为Fabric在对排序达成最终协议之前执行交易。

在Fabric中，特定应用程序的背书策略指定哪些节点或多少节点需要保证正确执行给定的智能合约。因此，每个交易只需要由满足交易的背书策略所必需的节点的子集来执行（背书）。这样可以并行执行，从而提高系统的整体性能和规模。第一阶段也**消除了任何不确定性**，因为在排序之前可以滤除不一致的结果。

因为我们已经消除了不确定性，Fabric是第一个**能使用标准编程语言**的区块链技术。在1.1.0版本中，智能合约可以用Go或Node.js编写，而在后续版本中，也将计划支持其他流行语言，包括Java。

## Privacy and Confidentiality - 隐私和保密

正如我们所讨论的，在一个公共的、非许可的区块链网络中，利用PoW作为其共识模型，交易在每个节点上执行。这意味着合同本身和他们处理的交易数据都不保密。每个交易以及实现它的代码，对于网络中的每个节点都是可见的。在这种情况下，我们交易了PoW提供的拜占庭容错共识的合同和数据的保密性。

对于许多商业/企业用例而言，保密性的缺乏可能会有问题。例如，在供应链合作伙伴网络中，某些消费者可能会获得优惠利率，作为巩固关系或促进额外销售的手段。如果每个参与者都可以看到每个合同和交易，那么，每个人都希望获得优惠费率！这样就无法在完全透明的网络中维持这种商业关系。

第二个例子是证券行业的，建立头寸（或处置）的交易者不希望被她的竞争对手知道，否则他们将试图进入游戏，制定削弱交易者的策略。

为了解决企业用例要求导致的缺乏隐私和保密的问题，区块链平台采用了多种方法。所有方法都需要权衡利弊。

加密数据是提供保密性的一种方法；然而，在利用PoW达成共识的非许可网络中，加密数据位于每个节点上。如果有足够的时间和计算资源，加密可能会被破解。对于许多企业用例，信息可能受损的风险是不能接受的。

零知识证明（ZKP）是正在探索解决该问题的另一个研究领域。目前，计算ZKP需要相当多的时间和计算资源，因此，在这种情况下的利弊权衡是资源消耗与保密性能。

在可以利用其他形式共识的许可情况下，人们可以探索将机密信息限制于授权节点的方法。

Hyperledger Fabric是一个许可平台，通过其通道架构实现保密。基本上，Fabric网络上的参与者可以在参与者子集之间建立“通道”，该通道应被授予对特定交易集的可见性。将此视为网络覆盖。从而只有参与频道的节点才能访问智能合约（链码）和数据交易，保护了两者的隐私和保密性。

为了提高其隐私和机密性能，Fabric增加了对[私有数据](./private-data/private-data.html)的支持，并且正在开发未来可用的零知识证明（ZKP）。随着它变得可用，将会有更多这方面的研究。

## Pluggable Consensus - 可插入的共识

交易的排序被委托给模块化组件以达成共识，该组件在逻辑上与执行交易（特别是排序交易）和维护分类帐的节点分离。由于共识是模块化的，可以根据特定部署或解决方案的信任假设来定制其实现。这种模块化架构允许平台依赖完善的工具包进行CFT（崩溃容错）或BFT（拜占庭容错）的排序。

在当前可用的版本中，Fabric提供了使用[Kafka](https://kafka.apache.org/)和[Zookeeper](https://zookeeper.apache.org/)实现的CFT订购服务。在之后的版本中，Fabric将提供使用etcd/Raft实现的[Raft共识排序服务](https://raft.github.io/)以及完全去中心化的BFT排序服务。


需要注意的是，这些并不相互排斥。Fabric网络可以有多种排序服务，支持不同的应用或应用要求。

## Performance and Scalability - 性能和可伸缩性

区块链平台的性能可能会受到许多变量的影响，例如交易大小，区块大小，网络大小以及硬件限制等。Hyperledger社区目前正在开发性能和规模工作组中的[一套衡量标准草案](https://docs.google.com/document/d/1DQ6PqoeIH0pCNJSEYiw7JVbExDvWh_ZRVhWkuioG4k0/edit#heading=h.t3gztry2ja8i)，以及称为[Hyperledger Caliper](https://wiki.hyperledger.org/projects/caliper)的基准的测试框架的相应实现 。

目前，这项工作仍在开发中，且应为区块链平台性能和规模特征的明确衡量标准。同时，IBM Research的一个团队发表了一份[同行评审论文](https://arxiv.org/abs/1801.10228v1)，评估了Hyperledger Fabric的架构和性能，提供了对Fabric架构的深入讨论，然后通过Hyperledger Fabric v1.1初版报告了团队对平台的性能评估。

研究团队所做的基准测试工作为Fabric v1.1.0版本带来了巨大的性能改进，与v1.0.0版本相比，平台的整体性能提高了一倍以上。

## Conclusion - 结论

任何对区块链平台的认真评估都应该在其名单中包含Hyperledger Fabric。

而且，Fabric的差异化功能使其成为一个高度可扩展的系统，用于支持灵活的信任假设的许可区块链，使该平台能够支持从政府，金融，供应链物流到医疗保健等的各种更多的行业用例。

更重要的是，Hyperledger Fabric（目前）是十个Hyperledger项目中最活跃的。围绕平台的社区建设正在稳步增长，相继每个版本提供的创新远远超过任何其他企业区块链平台。

## Acknowledgement - 致谢

前面的内容源自同行审阅的 [“Hyperledger Fabric：一个许可区块链的分布式操作系统”](https://arxiv.org/abs/1801.10228v1) - Elli Androulaki，Artem Barger，Vita Bortnikov，Christian Cachin，Konstantinos Christidis，Angelo De Caro，David Enyeart，Christopher Ferris，Gennady Laventman，Yacov Manevich，Srinivasan Muralidharan，Chet Murthy，Binh Nguyen，Manish Sethi，Gari Singh，Keith Smith，Alessandro Sorniotti，Chrysoula Stathakopoulou，Marko Vukolic，Sharon Weed Cocco，Jason Yellick